# Using django, django-rest-framework, and django-rest-datatables, to construct an API for the capitalism app
Continues from capitalism 10.2

## Commit Initial Commit (with postgres)

First use of pandas - initialize projects

## Commit Pandas added, projects initialized, empty DB created
## Commit Projects and TimeStamps initialized
## Commit all data initialized
## Commit filters working
## Commit tables displaying correctly
## Commit general tidy, API reduced to one (template) [not quite working], __str__ changed to uniform standard, spurious project columns pruned

A lot of debugging
NOTE: to create a clone, the correct technique seems to be:
*retrieve an object
*set object.pk=None
*save it

## Commit 'step' now seems to be working

Primitive logging system created
Exchange is now working
However, demand for consumption goods is overestimated
This is because in Capitalism 9.0, social class demand for goods was constrained by their money
Not sure if we want to retain money constraints at this point
Will take a look at the Capitalism 9.0 code and then decide
Meantime, good point for a commit

## Commit Exchange now working

Added consumption_ratio

## Commit Exchange now working with correct purchases of consumption goods

Started using bootstrap collapsibles
Rebuilt button system as a basic test. Works fine
Now we want to rebuild the logging system as per capitalism 9.0, which allows us to home in on the detail of what the simulation is doing
As a template, we're looking at   <!-- https://bootsnipp.com/snippets/K3x   -->
First we'll commit what we've done so far

## Commit collapsible action and table displays

To generate a nested display for the log, we will attempt a recursive script generator which uses the level of the log to decide what is the level of collapse

The display is nested but the construction was crude
Hide/Show partially implemented
Visibility of the log file sufficiently improved that we will move on

## Commit interim usable log display created

Update to bootstrap 5.1.3
Add bootstrap-icons

## Commit update to bootstrap 5 and add bootstrap-icons

Button and layout styling improved
Scaffolded Production Stage
TODO persist the toggled action and table layouts
TODO permanent header (don't scroll the whole thing) DONE (Apparently doesn't work with browsers that don't implement 'sticky') see https://caniuse.com/css-sticky

## Commit Scaffolded Production

## Commit Navbar with Sticky Header

Production stages added and debugged to the point where the syntax errors are gone
Bugs remain in the actual output but this is the next stage

## Commit Production, price and reproduction stages now coded but to be debugged

Possible tidy-ups
 - can we use 'add' in the initialize and step procedures?
 - getters and setters?
 
### Some Tidy-ups
 * Created 'models' folder
  * Moved models.py into models folder and refactored
  * Split out the owners.py, stocks.py and commodities.py models to facilitate cross-referencing (and for ease of access)
 * Created 'actions' folder
  * moved exchange.py, control.py and produce.py into it and refactored
 * Tested

## Commit Refactored models and actions functions

 * Tried to improve the subclassing but didn't get very far
 * Could not get overriding to work in the stock subclasses
 * However, in the course of debugging, the whole thing now seems to work on Project 1 up to the end of the 'Produce' phase

## Commit working up to 'reproduce' phase

Dropdown list for actions. 
TODO it's in the wrong place, but more user-friendly

## Commit Styling Improvements

Try to rationalise the choice fields using named constants
Debugged, but there seems to be an error in production stage - Department I sales stock has not been debited
We will try to resolve this whilst completing the creation of StockOwner getters for Sales, Money, Consumption and Production stocks
Most likely arises from misnaming

## Commit named constants

Subclassing now much better
Tests right through to reproduction

TODO comparator_time_stamp and proper stepping

## Commit subclassing improved

Created the substate and superstate models
Caused a lot of trouble
Doesn't like the foreign keys I wanted to use
Use state names instead
Deleted all migrations including cached
Deleted the database and recreated it
Ran MakeMigrations and Migrate
Tested

## Commit State Models created


